Distributed.@everywhere using RCall,CSV,DataFrames,GZip
Distributed.@everywhere include("gwas_tools.jl")

include("gwas_cis_regions.jl")
include("gwas_maf_filter.jl")
include("gwas_fdr.jl")
include("gwas_ld.jl")
include("gwas_extract_snps_met.jl")
include("gwas_extract_snps.jl")
include("gwas_mrjoin.jl")
include("gwas_mr.jl")

study = ARGS[1[]]
#start_stop = parse(Float64,ARGS[2])
start_stop = ARGS[2]
start_stop_arr = split(start_stop,"-")
start = parse(Float64,start_stop_arr[1])
stop = parse(Float64,start_stop_arr[2])

function call_pm_network_pipeline(somaid_arr, root_path, on_google, gwas_file_post, maf, fdr_level, ld_thresh, tss_tol, study, start)

    if start <= 1 && stop >= 1
        println("Starting gwas_cis_regions...")
        somaid_arr = call_gwas_cis_regions(somaid_arr,root_path,on_google,tss_tol,study)
        println("Finished gwas_cis_regions!")
    end

    if start <= 2 && stop >= 2
        println("Starting gwas_maf_filter...")
        call_gwas_maf_filter(somaid_arr,maf,root_path,study)
        println("Finished gwas_maf_filter!")
    end

    if start <= 3 && stop >= 3
        println("Starting gwas_fdr...")
        call_gwas_fdr(somaid_arr,fdr_level,root_path,maf,study)
        println("Finished gwas_fdr!")
    end

    if start <= 4 && stop >= 4
        println("Starting gwas_ld...")
        call_gwas_ld_reduce(root_path,ld_thresh,fdr_level,gwas_file_post,tss_tol,maf,study)
        println("Finished gwas_ld!")
    end

    if start <= 5 && stop >= 5
        println("Starting gwas_extract_snps...")
        call_gwas_extract_snps_met(met_arr,somaid_arr,fdr_level,root_path,on_google,study)
        call_gwas_extract_snps(somaid_arr,fdr_level,root_path,on_google,study)
        println("Finished gwas_extract_snps!")
    end

    #println("Starting gwas_shared_loci...")
    #include("gwas_shared_loci.jl")
    #include("gwas_shared_met_loci.jl")
    #println("Finished gwas_shared_loci!")

    if start <= 6 && stop >= 6
        println("Starting gwas_mrjoin...")
        call_gwas_innerjoin_mr(root_path,fdr_level,maf,study)
        println("Finished gwas_mrjoin!")
    end

    if start <= 7 && stop >= 7
        println("Starting gwas_mr...")
        call_gwas_mr(root_path, mr_use_corr,fdr_level,tss_tol,study)
        println("Finished gwas_mr!")
    end

end

# parameters
#root_path = "/home/aaron_eisman"
root_path = "/home/aaroneisman"
on_google = 1

somaid_arr = ["SL000001","SL000002","SL000003","SL000004","SL000006","SL000007","SL000009","SL000011","SL000017","SL000019","SL000020","SL000021","SL000022","SL000024","SL000027","SL000038","SL000039","SL000045","SL000047","SL000048","SL000049","SL000051","SL000052","SL000053","SL000055","SL000057","SL000062","SL000064","SL000070","SL000074","SL000076","SL000084","SL000087","SL000088","SL000089","SL000104","SL000124","SL000125","SL000130","SL000131","SL000133","SL000134","SL000136","SL000137","SL000138","SL000139","SL000142","SL000145","SL000158","SL000164","SL000247","SL000248","SL000249","SL000250","SL000251","SL000252","SL000254","SL000268","SL000271","SL000272","SL000276","SL000277","SL000280","SL000283","SL000299","SL000300","SL000305","SL000306","SL000308","SL000309","SL000310","SL000312","SL000313","SL000314","SL000316","SL000318","SL000319","SL000320","SL000321","SL000322","SL000323","SL000324","SL000325","SL000337","SL000338","SL000339","SL000342","SL000343","SL000344","SL000345","SL000346","SL000347","SL000357","SL000358","SL000360","SL000377","SL000382","SL000383","SL000384","SL000396","SL000398","SL000401","SL000403","SL000406","SL000408","SL000409","SL000414","SL000415","SL000420","SL000424","SL000426","SL000427","SL000428","SL000433","SL000437","SL000441","SL000442","SL000445","SL000448","SL000449","SL000450","SL000451","SL000454","SL000455","SL000456","SL000458","SL000459","SL000460","SL000461","SL000462","SL000466","SL000467","SL000468","SL000470","SL000474","SL000478","SL000479","SL000480","SL000481","SL000483","SL000485","SL000493","SL000496","SL000497","SL000498","SL000506","SL000507","SL000508","SL000509","SL000510","SL000515","SL000516","SL000517","SL000519","SL000521","SL000522","SL000523","SL000524","SL000525","SL000526","SL000527","SL000528","SL000530","SL000532","SL000535","SL000537","SL000539","SL000540","SL000541","SL000542","SL000545","SL000546","SL000550","SL000551","SL000553","SL000554","SL000556","SL000557","SL000558","SL000560","SL000563","SL000565","SL000566","SL000570","SL000572","SL000573","SL000581","SL000582","SL000584","SL000586","SL000587","SL000588","SL000589","SL000590","SL000591","SL000592","SL000597","SL000598","SL000601","SL000603","SL000605","SL000613","SL000615","SL000616","SL000617","SL000622","SL000633","SL000638","SL000640","SL000645","SL000655","SL000658","SL000668","SL000670","SL000674","SL000678","SL000695","SL000836","SL001691","SL001713","SL001716","SL001717","SL001718","SL001720","SL001721","SL001726","SL001728","SL001729","SL001731","SL001737","SL001753","SL001761","SL001766","SL001774","SL001777","SL001791","SL001795","SL001796","SL001797","SL001800","SL001802","SL001815","SL001880","SL001888","SL001890","SL001896","SL001897","SL001902","SL001905","SL001938","SL001943","SL001945","SL001947","SL001973","SL001990","SL001992","SL001995","SL001996","SL001997","SL001998","SL001999","SL002036","SL002071","SL002075","SL002078","SL002081","SL002086","SL002093","SL002505","SL002506","SL002508","SL002517","SL002519","SL002522","SL002524","SL002525","SL002528","SL002539","SL002541","SL002542","SL002561","SL002565","SL002602","SL002621","SL002640","SL002644","SL002646","SL002650","SL002654","SL002655","SL002662","SL002684","SL002688","SL002695","SL002702","SL002704","SL002705","SL002706","SL002722","SL002755","SL002756","SL002762","SL002763","SL002783","SL002785","SL002792","SL002803","SL002823","SL002922","SL003041","SL003043","SL003060","SL003066","SL003080","SL003104","SL003166","SL003167","SL003168","SL003169","SL003170","SL003171","SL003172","SL003173","SL003176","SL003177","SL003178","SL003179","SL003182","SL003183","SL003184","SL003186","SL003187","SL003188","SL003189","SL003190","SL003191","SL003192","SL003193","SL003196","SL003197","SL003198","SL003199","SL003200","SL003201","SL003220","SL003280","SL003300","SL003301","SL003302","SL003303","SL003304","SL003305","SL003307","SL003308","SL003309","SL003310","SL003322","SL003323","SL003324","SL003326","SL003327","SL003328","SL003329","SL003331","SL003332","SL003334","SL003340","SL003341","SL003349","SL003362","SL003440","SL003461","SL003520","SL003522","SL003524","SL003542","SL003643","SL003646","SL003647","SL003648","SL003650","SL003653","SL003655","SL003657","SL003658","SL003672","SL003674","SL003679","SL003680","SL003685","SL003687","SL003690","SL003700","SL003703","SL003704","SL003710","SL003711","SL003717","SL003722","SL003726","SL003728","SL003733","SL003735","SL003738","SL003739","SL003744","SL003753","SL003755","SL003761","SL003764","SL003770","SL003774","SL003785","SL003792","SL003793","SL003800","SL003803","SL003848","SL003849","SL003862","SL003863","SL003869","SL003872","SL003915","SL003916","SL003918","SL003919","SL003930","SL003951","SL003970","SL003974","SL003990","SL003993","SL003994","SL004008","SL004009","SL004010","SL004015","SL004016","SL004060","SL004063","SL004064","SL004066","SL004067","SL004068","SL004070","SL004078","SL004080","SL004081","SL004097","SL004101","SL004118","SL004119","SL004120","SL004125","SL004126","SL004128","SL004131","SL004133","SL004134","SL004136","SL004137","SL004139","SL004140","SL004141","SL004142","SL004143","SL004144","SL004145","SL004146","SL004147","SL004148","SL004149","SL004151","SL004152","SL004153","SL004154","SL004155","SL004156","SL004157","SL004159","SL004160","SL004180","SL004182","SL004183","SL004208","SL004230","SL004248","SL004253","SL004258","SL004260","SL004269","SL004271","SL004296","SL004297","SL004298","SL004299","SL004301","SL004304","SL004305","SL004306","SL004326","SL004327","SL004329","SL004330","SL004331","SL004332","SL004333","SL004334","SL004335","SL004336","SL004337","SL004338","SL004339","SL004340","SL004342","SL004343","SL004345","SL004346","SL004347","SL004348","SL004349","SL004350","SL004351","SL004352","SL004353","SL004354","SL004355","SL004356","SL004357","SL004359","SL004360","SL004362","SL004363","SL004364","SL004365","SL004366","SL004367","SL004396","SL004400","SL004415","SL004438","SL004457","SL004458","SL004466","SL004467","SL004469","SL004475","SL004477","SL004482","SL004484","SL004486","SL004489","SL004492","SL004511","SL004515","SL004516","SL004536","SL004556","SL004557","SL004579","SL004580","SL004588","SL004589","SL004591","SL004594","SL004605","SL004610","SL004625","SL004626","SL004635","SL004636","SL004637","SL004639","SL004642","SL004643","SL004645","SL004646","SL004648","SL004649","SL004650","SL004652","SL004654","SL004660","SL004661","SL004668","SL004669","SL004670","SL004671","SL004672","SL004673","SL004676","SL004683","SL004685","SL004686","SL004687","SL004689","SL004690","SL004692","SL004697","SL004698","SL004704","SL004708","SL004712","SL004714","SL004716","SL004718","SL004720","SL004723","SL004724","SL004725","SL004726","SL004733","SL004737","SL004739","SL004742","SL004747","SL004750","SL004751","SL004752","SL004757","SL004759","SL004760","SL004765","SL004768","SL004771","SL004781","SL004782","SL004783","SL004795","SL004804","SL004805","SL004811","SL004812","SL004814","SL004815","SL004820","SL004821","SL004823","SL004827","SL004829","SL004837","SL004838","SL004843","SL004844","SL004845","SL004849","SL004850","SL004851","SL004852","SL004853","SL004855","SL004856","SL004858","SL004859","SL004860","SL004861","SL004862","SL004863","SL004865","SL004866","SL004867","SL004868","SL004869","SL004871","SL004872","SL004875","SL004876","SL004891","SL004899","SL004901","SL004908","SL004910","SL004914","SL004915","SL004919","SL004920","SL004921","SL004924","SL004925","SL004932","SL004938","SL004939","SL004940","SL004984","SL005034","SL005059","SL005084","SL005087","SL005102","SL005115","SL005152","SL005153","SL005155","SL005156","SL005157","SL005158","SL005159","SL005160","SL005161","SL005164","SL005165","SL005166","SL005167","SL005168","SL005169","SL005170","SL005171","SL005172","SL005173","SL005174","SL005177","SL005178","SL005179","SL005181","SL005183","SL005184","SL005185","SL005187","SL005188","SL005189","SL005190","SL005191","SL005193","SL005194","SL005195","SL005196","SL005197","SL005199","SL005200","SL005201","SL005202","SL005204","SL005205","SL005206","SL005207","SL005208","SL005209","SL005210","SL005212","SL005213","SL005214","SL005215","SL005217","SL005218","SL005219","SL005220","SL005221","SL005223","SL005224","SL005225","SL005226","SL005227","SL005228","SL005229","SL005230","SL005231","SL005233","SL005234","SL005235","SL005236","SL005250","SL005256","SL005258","SL005261","SL005263","SL005266","SL005308","SL005352","SL005357","SL005358","SL005361","SL005372","SL005392","SL005430","SL005437","SL005488","SL005491","SL005493","SL005508","SL005572","SL005574","SL005575","SL005588","SL005629","SL005630","SL005675","SL005679","SL005685","SL005687","SL005688","SL005694","SL005699","SL005703","SL005725","SL005730","SL005764","SL005789","SL005793","SL005797","SL005846","SL006029","SL006088","SL006091","SL006108","SL006114","SL006119","SL006131","SL006132","SL006189","SL006197","SL006230","SL006268","SL006372","SL006374","SL006378","SL006397","SL006406","SL006448","SL006460","SL006476","SL006480","SL006512","SL006522","SL006523","SL006527","SL006528","SL006542","SL006544","SL006550","SL006610","SL006629","SL006675","SL006694","SL006698","SL006705","SL006713","SL006777","SL006803","SL006805","SL006830","SL006892","SL006910","SL006911","SL006912","SL006913","SL006914","SL006915","SL006916","SL006917","SL006918","SL006919","SL006920","SL006921","SL006922","SL006923","SL006924","SL006970","SL006992","SL006993","SL006998","SL007003","SL007022","SL007024","SL007025","SL007033","SL007049","SL007056","SL007059","SL007070","SL007100","SL007108","SL007121","SL007122","SL007136","SL007145","SL007151","SL007153","SL007173","SL007179","SL007181","SL007195","SL007206","SL007207","SL007217","SL007221","SL007223","SL007228","SL007229","SL007237","SL007242","SL007250","SL007261","SL007266","SL007272","SL007274","SL007280","SL007281","SL007284","SL007295","SL007306","SL007310","SL007311","SL007324","SL007327","SL007328","SL007336","SL007356","SL007358","SL007361","SL007373","SL007385","SL007429","SL007453","SL007471","SL007502","SL007531","SL007547","SL007560","SL007620","SL007631","SL007640","SL007642","SL007651","SL007673","SL007674","SL007680","SL007696","SL007729","SL007747","SL007752","SL007756","SL007774","SL007804","SL007806","SL007828","SL007869","SL007871","SL007888","SL007953","SL008008","SL008023","SL008039","SL008059","SL008063","SL008071","SL008072","SL008085","SL008094","SL008099","SL008102","SL008113","SL008122","SL008143","SL008157","SL008158","SL008176","SL008177","SL008178","SL008190","SL008193","SL008331","SL008360","SL008372","SL008378","SL008380","SL008381","SL008382","SL008402","SL008414","SL008416","SL008421","SL008466","SL008486","SL008504","SL008516","SL008522","SL008574","SL008588","SL008590","SL008591","SL008609","SL008611","SL008614","SL008623","SL008631","SL008639","SL008703","SL008709","SL008728","SL008759","SL008760","SL008773","SL008808","SL008810","SL008822","SL008835","SL008837","SL008865","SL008904","SL008909","SL008916","SL008931","SL008933","SL008936","SL008945","SL008956","SL008967","SL009045","SL009054","SL009089","SL009202","SL009207","SL009210","SL009213","SL009216","SL009324","SL009328","SL009341","SL009349","SL009400","SL009412","SL009431","SL009628","SL009629","SL009768","SL009790","SL009791","SL009792","SL009868","SL009948","SL009951","SL009988","SL010250","SL010288","SL010328","SL010348","SL010349","SL010368","SL010369","SL010372","SL010373","SL010374","SL010375","SL010376","SL010378","SL010379","SL010381","SL010384","SL010388","SL010390","SL010391","SL010393","SL010449","SL010450","SL010451","SL010454","SL010455","SL010456","SL010457","SL010458","SL010459","SL010460","SL010461","SL010462","SL010463","SL010464","SL010465","SL010466","SL010467","SL010468","SL010469","SL010470","SL010471","SL010488","SL010489","SL010490","SL010491","SL010492","SL010493","SL010494","SL010495","SL010496","SL010498","SL010499","SL010500","SL010501","SL010502","SL010503","SL010505","SL010508","SL010509","SL010510","SL010512","SL010513","SL010514","SL010515","SL010516","SL010517","SL010518","SL010519","SL010520","SL010521","SL010522","SL010523","SL010524","SL010528","SL010529","SL010530","SL010610","SL010612","SL010613","SL010616","SL010617","SL010619","SL010830","SL010927","SL010928","SL010973","SL011049","SL011068","SL011069","SL011071","SL011073","SL011100","SL011180","SL011202","SL011211","SL011232","SL011400","SL011404","SL011405","SL011406","SL011448","SL011498","SL011499","SL011508","SL011509","SL011510","SL011528","SL011529","SL011530","SL011532","SL011533","SL011535","SL011549","SL011588","SL011616","SL011628","SL011629","SL011630","SL011631","SL011708","SL011709","SL011768","SL011769","SL011770","SL011772","SL011808","SL011809","SL011888","SL012108","SL012148","SL012168","SL012188","SL012248","SL012395","SL012457","SL012469","SL012517","SL012538","SL012561","SL012698","SL012707","SL012740","SL012754","SL012769","SL012774","SL012783","SL012822","SL012881","SL013165","SL013240","SL013488","SL013489","SL013490","SL013548","SL013570","SL013754","SL013872","SL013928","SL013969","SL013988","SL013989","SL014008","SL014009","SL014028","SL014029","SL014048","SL014069","SL014070","SL014071","SL014088","SL014091","SL014092","SL014093","SL014094","SL014096","SL014108","SL014111","SL014113","SL014129","SL014130","SL014148","SL014188","SL014208","SL014209","SL014228","SL014229","SL014248","SL014268","SL014269","SL014270","SL014288","SL014289","SL014292","SL014294","SL014308","SL014468","SL014469","SL014470","SL014488","SL014684","SL014735","SL014896","SL014983","SL015046","SL015510","SL015728","SL016128","SL016129","SL016130","SL016148","SL016548","SL016549","SL016550","SL016551","SL016553","SL016554","SL016555","SL016557","SL016563","SL016566","SL016567","SL016828","SL016928","SL016969","SL017106","SL017128","SL017188","SL017189","SL017289","SL017290","SL017328","SL017424","SL017528","SL017529","SL017610","SL017612","SL017614","SL018256","SL018509","SL018548","SL018587","SL018625","SL018629","SL018887","SL018891","SL018900","SL018921","SL018938","SL018946","SL018947","SL018971","SL019019","SL019096","SL019100","SL019978","SL019979","SL020171","SL020172","SL021043","SL002782","SL017611","SL004209","SL010371","SL005222","SL010504","SL002731","SL005403","SL004644","SL004864","SL003320"]
## removed for heritage
#

#somaid_arr = ["SL008644"] "SL000440",
#remove SL008644 - no cis region
# removed X chr from gene_locs file
# delete rows of gwas with nan as p val
# got master gene_locs file
# if no gene_loc, remove from somaid_arr


if study == "jhs"
    #JHS
    met_arr = ["MP1001","MP1002","MP1003","MP1004","MP1005","MP1006","MP1007","MP1008","MP1009","MP1010","MP1011","MP1012","MP1013","MP1014","MP1015","MP1016","MP1017","MP1018","MP1019","MP1020","MP1021","MP1022","MP1023","MP1024","MP1025","MP1026","MP1027","MP1028","MP1029","MP1030","MP1031","MP1032","MP1033","MP1034","MP1035","MP1036","MP1037","MP1038","MP1039","MP1040","MP1041","MP1042","MP1043","MP1044","MP1045","MP1046","MP1047","MP1048","MP1049","MP1050","MP1051","MP1052","MP1053","MP1054","MP1055","MP1056","MP1057","MP1058","MP1059","MP1060","MP1061","MP1062","MP1063","MP1064","MP1065","MP1066","MP1067","MP1068","MP1069","MP1070","MP1071","MP1072","MP1073","MP1074","MP1075","MP1076","MP1077","MP1078","MP1079","MP1080","MP1081","MP1082","MP1083","MP1084","MP1085","MP1086","MP1087","MP1088","MP1089","MP1090","MP1091","MP1092","MP1093","MP1094","MP1095","MP1096","MP1097","MP1098","MP1099","MP1100","MP1101","MP1102","MP1103","MP1104","MP1105","MP1106","MP1107","MP1108","MP1109","MP1110","MP1111","MP1112","MP1113","MP1114","MP1115","MP1116","MP1117","MP1118","MP1119","MP1120","MP1121","MP1122","MP1123","MP1124","MP1125","MP1126","MP1127","MP1128","MP1129","MP1130","MP1131","MP1132","MP1133","MP1134","MP1135","MP1136","MP1137","MP1138","MP1139","MP1140","MP1141","MP1142","MP1143","MP1144","MP1145","MP1146","MP1147","MP1148","MP1149","MP1150","MP1151","MP1152","MP1153","MP1154","MP1155","MP1156","MP1157","MP1158","MP1159","MP1160","MP1161","MP1162","MP1163","MP1164","MP1165","MP1166","MP1167","MP1168","MP1169","MP1170","MP1171","MP1172","MP1173","MP1174","MP1175","MP1176","MP1177","MP1178","MP1179","MP1180","MP1181","MP1182","MP1183","MP1184","MP1185","MP1186","MP1187","MP1188","MP1189","MP1190","MP1191","MP1192","MP1193","MP1194","MP1195","MP1196","MP1197","MP1198","MP1199","MP1200","MP1201","MP1202","MP1203","MP1204","MP1205","MP1206","MP1207","MP1208","MP3622","MP3623","MP3624","MP3625","MP3626","MP3627","MP3628","MP3629","MP3630","MP3631","MP3632","MP3633","MP3634","MP3635","MP3636","MP3637","MP3638","MP3639","MP3640","MP3641","MP3642","MP3643","MP3644","MP3645","MP3646","MP3647","MP3648","MP3649","MP3849","MP3850","MP3851","MP3852","MP3853","MP3854","MP3855","MP3856","MP3857","MP4036","MP4037","MP4038","MP4039","MN1001","MN1002","MN1003","MN1004","MN1005","MN1006","MN1007","MN1008","MN1009","MN1010","MN1011","MN1012","MN1013","MN1014","MN1015","MN1016","MN1017","MN1018","MN1019","MN1020","MN1021","MN1022","MN1023","MN1024","MN1025","MN1026","MN1027","MN1028","MN1029","MN1030","MN1031","MN1032","MN1033","MN1034","MN1035","MN1036","MN1037","MN1038","MN1039","MN1040","MN1041","MN1042","MN1043","MN1044","MN1045","MN1046","MN1047","MN1048","MN1049","MN1050","MN1051","MN1052","MN1053","MN1054","MN1055","MN1056","MN1057","MN1058","MN1059","MN1060","MN1061","MN1062","MN1063","MN1064","MN1065","MN1066","MN1067","MN1068","MN1069","MN1070","MN1071","MN1072","MN1073","MN1074","MN1075","MN1076","MN1077","MN1078","MN1079","MN1080","MN1081","MN1082","MN1083","MN1084","MN1085","MN1086","MN1087","MN1088","MN1089","MN1090","MN1091","MN1092","MN1093","MN1094","MN1095","MN1096","MN1097","MN1098","MN1099","MN1100","MN1101","MN1102","MN1103","MN1104","MN1105","MN1106","MN1107","MN1108","MN1109","MN1110","MN1111","MN1112","MN1113","MN1114","MN1115","MN1116","MN1117","MN1118","MN1119","MN1120","MN1121","MN1122","MN1123","MN1124","MN1125","MN1126"]

elseif study == "mesa"
    #MESA
    met_arr = ["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120","M121","M122","M123","M124","M125","M126","M127","M128","M129","M130","M131","M132","M133","M134","M135","M136","M137","M138","M139","M140","M141","M142","M143","M144","M145","M146","M147","M148","M149","M150","M151","M152","M153","M154","M155","M156","M157","M158","M159","M160","M161","M162","M163","M164","M165","M166","M167","M168","M169","M170","M171","M172","M173","M174","M175","M176","M177","M178","M179","M180","M181","M182","M183","M184","M185","M186","M187","M188","M189","M190","M191","M192","M193","M194","M195","M196","M197","M198","M199","M200","M201","M202","M203","M204","M205","M206","M207","M208","M209","M210","M211","M212","M213","M214","M215","M216","M217","M218","M219","M220","M221","M222","M223","M224","M225","M226","M227","M228","M229","M230","M231","M232","M233","M234","M235","M236","M237","M238","M239","M240","M241","M242","M243","M244","M245","M246","M247","M248","M249","M250","M251","M252","M253","M4220","M4221","M4222","M4223","M4224","M4225","M4226","M4227","M4228","M4229","M4230","M4231","M4232","M4233","M4234","M4235","M4236","M4237","M4238","M4239","M4240","M4241","M4242","M4243","M4244","M4245","M4246","M4247","M4248","M4249","M4250","M4251","M4252","M4253","M4254","M4255","M4256","M4257","M4258","M4259","M4260","M4261","M4262","M4263","M4264","M4265","M4266","M4267","M4268","M4269","M4270","M4271","M4272","M4273","M4274","M4275","M4276","M4277","M4278","M4279","M4280","M4281","M4282","M4283","M4284","M4285","M4286","M4287","M4288","M4289","M4290","M4291","M4292","M4293","M4294","M4295","M4296","M4297","M4298","M4299","M4300","M4301","M4302","M4303","M4304","M4305","M4306","M4307","M4308","M4309","M4310","M4311","M4312","M4313","M4314","M4315","M4316","M4317","M4318","M4319","M4320","M4321","M4322","M4323","M4324","M4325","M4326","M4327","M4328","M4329","M4330","M4331","M4332","M4333","M4334","M4335","M4336","M4337","M4338","M4339","M4340","M4341","M4342","M4343","M4344","M4345","M4346","M4347","M4348","M4349","M4350","M4351","M4352","M4353","M4354","M4355","M4356","M4357","M4358","M4359","M4360","M4361","M4362","M4363","M4364","M4365","M4366","M4367","M4368","M4369","M4370","M4371","M4372","M4373","M4374","M4375","M4376","M4377","M4378","M4379","M4380","M4381","M4382","M4383","M4384","M4385","M4386","M4387","M4388","M4389","M4390","M4391","M4392","M4393","M4394","M4395","M4396","M4397","M4398","M4399","M4400","M4401","M4402","M4403","M4404","M4405","M4406","M4407","M4408","M4409","M4410","M4411","M4412","M4413","M4414","M4415","M4416","M4417","M4418","M4419","M4420","M4421","M4422","M4423","M4424","M4425","M4426","M4427","M4428","M4429","M4430","M4431","M4432","M4433","M4434","M4435","M4436","M4437","M4438","M4439","M4440","M4441","M4442","M4443","M4444","M4445","M4446","M4447","M4448","M4449","M4450","M4451","M4452","M4453","M4454","M4455","M4456","M4457","M4458","M4459","M4460","M4461","M4462","M4463","M4464","M4465","M4466","M4467","M4468","M4469","M4470","M4471","M4472","M4473","M4474","M4475","M4476","M4477","M4478","M4479","M4480","M4481","M4482","M4483","M4484","M4485","M4486","M4487","M4488","M4489","M4490","M4491","M4492","M4493","M4494","M4495","M4496","M4497","M4498","M4499","M4500","M4501","M4502","M4503","M4504","M4505","M4506","M4507","M4508","M4509","M4510","M4511","M4512","M4513","M4514","M4515","M4516","M4517","M4518","M4519","M4520","M4521","M4522","M4523","M4524","M4525","M4526","M4527","M4528","M4529","M4530","M4531","M4532","M4533","M4534","M4535","M4536","M4537","M4538","M4539","M4540","M4541","M4542","M4543","M4544","M4545","M4546","M4547","M4548","M4549","M4550","M4551","M4552","M4553","M4554","M4555","M4556","M4557","M4558","M4559","M4560","M4561","M4562","M4563","M4564","M4565","M4566","M4567","M4568","M4569","M4570","M4571","M4572","M4573","M4574","M4575","M4576","M4577","M4578","M4579","M4580","M4581","M4582","M4583","M4584","M4585","M4586","M4587","M4588","M4589","M4590","M4591","M4592","M4593","M4594","M4595","M4596","M4597","M4598","M4599","M4600","M4601","M4602","M4603","M4604","M4605","M4606","M4607","M4608","M4609","M4610","M4611","M4612","M4613","M4614","M4615","M4616","M4617","M4618","M4619","M4620","M4621","M4622","M4623","M4624"]
elseif study == "heritage"
    #HERITAGE
    met_arr = ["MNH1001","MNH1002","MNH1003","MNH1004","MNH1005","MNH1006","MNH1007","MNH1008","MNH1009","MNH1010","MNH1011","MNH1012","MNH1013","MNH1015","MNH1016","MNH1018","MNH1019","MNH1020","MNH1021","MNH1022","MNH1023","MNH1024","MNH1025","MNH1026","MNH1027","MNH1028","MNH1029","MNH1030","MNH1031","MNH1032","MNH1033","MNH1036","MNH1037","MNH1038","MNH1039","MNH1040","MNH1041","MNH1042","MNH1043","MNH1044","MNH1046","MNH1047","MNH1048","MNH1049","MNH1050","MNH1052","MNH1053","MNH1054","MNH1055","MNH1056","MNH1057","MNH1058","MNH1059","MNH1060","MNH1061","MNH1062","MNH1063","MNH1064","MNH1065","MNH1066","MNH1067","MNH1068","MNH1069","MNH1070","MNH1071","MNH1072","MNH1073","MNH1074","MNH1075","MNH1076","MNH1077","MNH1078","MNH1079","MNH1080","MNH1081","MNH1082","MNH1083","MNH1084","MNH1085","MNH1086","MNH1087","MNH1088","MNH1089","MNH1090","MNH1091","MNH1092","MNH1094","MNH1095","MNH1096","MNH1097","MNH1098","MNH1099","MNH1100","MNH1101","MNH1102","MNH1103","MNH1104","MNH1105","MNH1106","MNH1107","MNH1108","MNH1109","MNH1110","MNH1111","MNH1112","MNH1113","MNH1114","MNH1115","MNH1116","MNH1117","MNH1118","MNH1119","MNH1120","MNH1121","MNH1123","MNH1124","MNH1125","MNH1126","MNH1127","MNH1128","MNH1129","MNH1130","MNH1131","MNH1132","QI10267","QI10327","QI10339","QI10366","QI10606","QI10853","QI10856","QI10966","QI10982","QI11158","QI11195","QI11247","QI11255","QI11287","QI11318","QI11372","QI11485","QI11486","QI11498","QI11549","QI11613","QI11642","QI11663","QI11706","QI11760","QI11775","QI11809","QI11834","QI11842","QI1195","QI11974","QI11981","QI11990","QI12121","QI12159","QI12174","QI12357","QI12361","QI12427","QI12518","QI12587","QI12650","QI12660","QI12682","QI12738","QI12819","QI12850","QI12913","QI12914","QI12965","QI12968","QI13062","QI13128","QI13189","QI13197","QI13252","QI13271","QI13305","QI13307","QI13309","QI13327","QI13328","QI13334","QI13344","QI13352","QI13428","QI13452","QI13508","QI13529","QI13563","QI13623","QI13641","QI13657","QI13664","QI13684","QI13743","QI13760","QI13810","QI13838","QI13855","QI13886","QI13917","QI13930","QI13934","QI14073","QI14081","QI14124","QI14149","QI1573","QI1714","QI2324","QI2376","QI2538","QI2673","QI3059","QI3101","QI3125","QI3148","QI3356","QI4891","QI5040","QI5260","QI5523","QI5567","QI5635","QI5639","QI5640","QI6173","QI6482","QI6783","QI6792","QI6888","QI6994","QI7145","QI7522","QI7608","QI7666","QI7737","QI7791","QI7847","QI8042","QI8094","QI8125","QI8149","QI8153","QI8170","QI8218","QI8326","QI8459","QI9001","QI9213","QI9256","QI9334","QI9341","QI9452","QI9570","QI9576","QI9621","QI9642","QI9668","QI9693","QI9731","QI9883","TF1","TF10","TF11","TF14","TF16","TF17","TF18","TF19","TF20","TF21","TF22","TF3","TF4"]

    # determine which protein results we have
    protein_files_fn = "protein_files.txt"
    prot_have_set = Set()
    io = open("$(root_path)/$(protein_files_fn)","r")
    for line in readlines(io)
        try
            #prot = match(r"SL[0-9]*+_",line).match
            her_prot = match(r"SL[0-9]*[AB]?(?=.)",line).match ### changed to include AB proteins on 1/12/2022
            prot = match(r"SL[0-9]*(?=[AB]?.)",line).match
            #push!(prot_have_set,chop(prot))
            if in(prot,Set(somaid_arr))
                push!(prot_have_set,her_prot)
            end   
            #push!(prot_have_set,prot) # don't chop
        catch
        end
    end
    close(io)

    #somaid_arr = collect(intersect(Set(somaid_arr),prot_have_set))
    somaid_arr = collect(prot_have_set)

    println(somaid_arr)
    sleep(20)

else
    @error("Study $(study) not recognized!")
end

#somaid_arr = ["SL008102","SL009216","SL005574"]
#somaid_arr = ["SL000003"]

gwas_file_post = "_cis.txt"

fdr_level_arr = [0.1,0.05,0.01]
ld_thresh_arr = [0.3,0.1,0.01]
tss_tol_arr = [1000000,200000,0]
tss_tol_arr = [60000,120000]
tss_tol_arr = [1000000,200000,120000,60000,0]

ld_thresh_arr = [0.01]
fdr_level_arr = ["bonf",0.01]
tss_tol_arr = [120000, 200000,500000,1000000,2000000,5000000]


ld_thresh_arr = [0.001]
#ld_thresh_arr = [0.80]
fdr_level_arr = ["bonf"]
tss_tol_arr = [1000000]
maf_arr = [0.01]
#mr_use_corr = 1 ## or anything else to not use corr
mr_use_corr = 0

#==
ld_thresh = 0.001
fdr_level = "bonf"
tss_tol = 1000000
maf = 0.01
use_corr = 0
==#

#fdr_level_arr = [0.1]
#ld_thresh_arr = [0.3]
#tss_tol_arr = [1000000]

for fdr_level in fdr_level_arr
    for ld_thresh in ld_thresh_arr
        for tss_tol in tss_tol_arr
            for maf in maf_arr
                rename_out = "$(root_path)/data/gwas_protein_out_$(study)_fdr_$(fdr_level)_ld_$(ld_thresh)_tss_$(tss_tol)_maf_$(maf)"
                if !ispath(rename_out) #check for existing results
                    try
                        mkdir("/home/aaroneisman/data/gwas_protein_out")
                    catch
                        @warn "Folder gwas_protein_out already exists!"
                    end

                    call_pm_network_pipeline(somaid_arr, root_path, on_google, gwas_file_post, maf, fdr_level, ld_thresh, tss_tol, study, start)

                    mv_str = "mv $(root_path)/data/gwas_protein_out $(rename_out)"
                    #run(`bash -c "$mv_str"`)
                end
            end
        end
    end
end


    ### to do
    # clean up parameters
    #create files for these long lists
    #allow pipeline start points
    #allow different output folders based on parameters